<div class="select-container" [class.open]="isOpen">
    <div
        class="select-header"
        (click)="toggleDropdown()"
        [class.has-value]="selectedOption"
        [class.focused]="isOpen"
    >
        @if (isOpen) {
        <input
            #searchInput
            type="text"
            [(ngModel)]="searchQuery"
            (input)="filterOptions()"
            (click)="preventClose($event)"
            class="search-input"
            placeholder="Пошук..."
        />
        } @if (!isOpen) {
        <span class="select-value" (click)="toggleDropdown($event)">
            {{ selectedOption ? getDisplayValue(selectedOption) : placeholder }}
        </span>
        }
        <svg
            class="arrow-icon"
            [class.open]="isOpen"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
        >
            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" />
        </svg>
    </div>

    @if (isOpen) {
    <div class="select-dropdown">
        @if (hasNoResults) {
        <div class="no-results">
            <mat-icon svgIcon="errorTriangle"></mat-icon>
            <span>По запиту "{{ searchQuery }}" нічого не знайдено</span>
        </div>
        } @for (option of filteredOptions; track option[valueField]) {
        <div
            class="option-item"
            [class.selected]="option[valueField] === selectedOption?.[valueField]"
            [class.faded]="!option.visible"
            (click)="selectOption(option)"
        >
            <span [innerHTML]="highlightText(getDisplayValue(option))"></span>
        </div>
        }
    </div>
    }
</div>
